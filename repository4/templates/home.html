<!DOCTYPE html>
<html>
    <head>
        <title>Live Score</title>
    </head>
    <body>
        <h1>Partite</h1>

        <h2>Programmati</h2>
        <div id="programmati"></div>

        <h2>Live</h2>
        <div id="live"></div>

        <h2>Terminate</h2>
        <div id="terminate"></div>
        <script>
            // WebSocket per aggiornamenti live
            const socket = new WebSocket("ws://localhost:2000/ws");

            socket.onmessage = function (event) {
                const data = JSON.parse(event.data);
                renderSection("programmati", data.programmati, "programmato");
                renderSection("live", data.live, "live");
                renderSection("terminati", data.terminati, "terminato");
            };
            function renderSection(containerId, matches, stato) {
                const container = document.getElementById(containerId);
                   container.innerHTML = "";

                matches.forEach(p => {
                    const div = document.createElement("div");
                    div.className = `match ${stato}`;
                    div.id = "match-" + p.id;

                    div.innerHTML = buildMatchHTML(p, stato);

                    // click per pagina di dettaglio
                    div.onclick = () => {
                        window.location.href = `dettaglio.html?id=${p.id}`;
                    };

                    container.appendChild(div);
                });
            }

            function buildMatchHTML(p, stato) {                                     ////
                let sportIcon = getSportIcon(p.sport);
                let tempo = stato === "live" ? `â±ï¸ ${p.tempo}'` : "";
                let statoIcon =
                    stato === "live" ? "ğŸ”´ LIVE" :
                    stato === "programmato" ? "â°" :
                    "â¹ï¸";

                let eventi = "";
                if (p.ammonizioni > 0) eventi += ` ğŸŸ¨ ${p.ammonizioni}`;
                if (p.interruzioni > 0) eventi += ` âŒ ${p.interruzioni}`;

                return `
                    <strong>${sportIcon} ${p.squadre}</strong><br>
                    ${statoIcon} âš½ ${p.punti} ${tempo}<br>
                    ${eventi}
                `;
            }

            function getSportIcon(sport) {
                switch (sport) {
                    case "calcio": return "âš½";
                    case "basket": return "ğŸ€";
                    case "tennis": return "ğŸ¾";
                    default: return "ğŸ®";
                }
            }

            // Aggiorna ogni 10s le partite programmati e terminate
            setInterval(loadMatches, 10000);
        </script>
    </body>
</html>