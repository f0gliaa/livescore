<!DOCTYPE html>
<html>
<head>
    <title>Live Score</title>
</head>
<body>
    <h1>Partite</h1>

    <h2>Programmati</h2>
    <div id="programmati"></div>

    <h2>Live</h2>
    <div id="live"></div>

    <h2>Terminate</h2>
    <div id="terminate"></div>

    <script>
        async function loadMatches() {
            const res = await fetch("/matches");
            const data = await res.json();

            const programmatiDiv = document.getElementById("programmati");
            const liveDiv = document.getElementById("live");
            const terminateDiv = document.getElementById("terminate");

            // per non avere duplicati
            programmatiDiv.innerHTML = "";
            liveDiv.innerHTML = "";
            terminateDiv.innerHTML = "";

            data.programmati.forEach(p => {
                const div = document.createElement("div");
                div.className = "match programmata";
                div.innerHTML = `${p.squadre} ‚öΩ ${p.sport}`;
                programmatiDiv.appendChild(div);
            });

            data.live.forEach(p => {
                const div = document.createElement("div");
                div.className = "match live";
                div.id = "match-" + p.id;
                div.innerHTML = `${p.squadre} ‚öΩ Punti: ${p.punti} üü® Ammonizioni: ${p.ammonizioni} ‚è±Ô∏è Tempo: 0s`;
                div.onclick = () => window.location.href = `/dettaglio.html?id=${p.id}`;
                liveDiv.appendChild(div);
            });

            data.terminati.forEach(p => {
                const div = document.createElement("div");
                div.className = "match terminata";
                div.innerHTML = `${p.squadre} ‚öΩ Punti: ${p.punti} üü® Ammonizioni: ${p.ammonizioni}`;
                terminateDiv.appendChild(div);
            });
        }

        loadMatches();

        // WebSocket per aggiornamenti live
        const socket = new WebSocket("ws://localhost:2000/livescore");
        socket.onmessage = function(event) {
            const p = JSON.parse(event.data);
            const div = document.getElementById("match-" + p.id);
            if(div) {
                div.innerHTML = `${p.squadre} ‚öΩ Punti: ${p.punti} üü® Ammonizioni: ${p.ammonizioni} ‚è±Ô∏è Tempo: 0s`;
            }
        };

        // Aggiorna ogni 10s le partite programmati e terminate
        setInterval(loadMatches, 10000);
    </script>
</body>
</html>